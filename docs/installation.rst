.. _installation:

Installation
=================

.. note::
   The Sorcha python package is currently pip installable. 

Sorcha Requirements
-----------------------------

Sorcha has the following requirements that will be automatically installed  using pip or conda when you install the sorcha package:

* python 3.9 or later
* numpy
* pandas
* scipy
* astropy
* matplotlib
* sbpy
* pytables
* difi == 1.2rc3
* spiceypy
* healpy
* assist
* rebound
* pooch
* tqdm

Setup Your Conda Environment 
------------------------------
**Step 1** Create a directory to contain the OIF and Sorcha repos::

   mkdir sorcha
   cd sorcha

.. tip::
   We recommend using python version 3.9 or higher with Sorcha. 

**Step 2** Create a conda environment::

   conda create -n sorcha -c conda-forge -c moeyensj numpy pandas scipy astropy matplotlib sbpy pytables difi==1.2rc3 spiceypy healpy rebound pooch tqdm python=3.10
   conda activate sorcha

Installing Sorcha 
----------------------------
**Step 1** Navigate to the directory you want to store the Sorcha soure code in::

   cd sorcha
   
**Step 2** Download the Sorcha soure code via::

   git clone https://github.com/dirac-institute/sorcha.git
   
**Step 3** Install an editable (in-place) development version of Sorcha. This will allow you to run the code from the source directory.::

   cd sorcha
   pip install -e .


Testing the Sorcha Installation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
You can check that the surveySimPP installation was done correctly, by running::

   sorcha -c ./demo/PPConfig_test.ini -p ./demo/sspp_testset_colours.txt -o ./demo/sspp_testset_orbits.des -e ./demo/example_oif_output.txt -u ./data/out/ -t testrun_e2e
   
The output will appear in a csv file (testrun_e2e.csv) in .data/out (this pathway can be changed via the -u command line argument). The first several lines of the csv file should look like::

   ObjID,FieldMJD,fieldRA,fieldDec,AstRA(deg),AstDec(deg),AstrometricSigma(deg),optFilter,observedPSFMag,observedTrailedSourceMag,PhotometricSigmaPSF(mag),PhotometricSigmaTrailedSource(mag),fiveSigmaDepth,fiveSigmaDepthAtSource
   632,60315.2441,141.4554595,8.1858813,142.5089358,8.434994,1.36e-05,r,22.607,22.722,0.084,0.084,23.783,23.771
   632,60315.26793,141.4554595,8.1858813,142.5075236,8.4352135,1.17e-05,i,22.587,22.509,0.09,0.09,23.595,23.583
   632,60322.248,141.0466609,9.4406351,142.0713696,8.5214621,7.9e-06,g,23.138,23.16,0.06,0.06,24.591,24.558
   632,60322.2717,141.0466609,9.4406351,142.0697072,8.5218264,5.9e-06,r,22.762,22.64,0.051,0.051,24.315,24.282
   632,60328.19755,141.6678165,7.1548011,141.64208,8.6235416,1.79e-05,z,22.517,22.556,0.139,0.139,22.962,22.918
   632,60328.25587,140.9158928,9.8725584,141.6375209,8.6246736,1.03e-05,i,22.423,22.368,0.08,0.079,23.619,23.579
   632,60328.27875,140.9158928,9.8725584,141.6357097,8.6251096,1.76e-05,z,22.729,22.423,0.136,0.136,22.982,22.943
   632,60328.30071,141.6678165,7.1548011,141.634002,8.6255457,1.71e-05,z,22.506,22.552,0.134,0.133,23.006,22.962
   632,60329.25405,142.8361496,7.6203923,141.5610457,8.6442007,9.4e-06,g,23.129,23.081,0.065,0.065,24.462,24.39
   632,60340.20215,140.7268621,9.0201761,140.6614046,8.8967256,1.04e-05,i,22.395,22.27,0.089,0.089,23.291,23.291
   632,60340.22599,140.7268621,9.0201761,140.6593039,8.8973371,1.37e-05,z,22.461,22.368,0.119,0.119,22.942,22.942
   632,60344.1987,140.326146,7.7906532,140.314112,9.0038707,3.22e-05,g,23.158,23.076,0.111,0.111,23.583,23.563
   632,60344.22335,140.326146,7.7906532,140.3118898,9.0045278,9.6e-06,r,22.345,22.586,0.061,0.061,23.802,23.782
   632,60344.27754,140.326146,7.7906532,140.307012,9.0060477,2.74e-05,i,22.111,22.477,0.121,0.121,22.894,22.875
   632,60344.30119,140.326146,7.7906532,140.3048883,9.0066966,2.52e-05,z,22.157,22.296,0.152,0.152,22.616,22.596
   632,60345.18907,140.2280447,8.5837329,140.2272922,9.0314101,1.23e-05,r,22.345,22.448,0.067,0.067,23.668,23.668
   632,60346.16835,141.2076529,9.0398667,140.1413377,9.0589925,1.68e-05,r,22.27,22.395,0.079,0.079,23.477,23.466
   632,60348.25973,140.0293005,8.965671,139.9570249,9.1190653,6.9e-06,r,22.447,22.326,0.049,0.049,24.011,24.011
   632,60351.19357,139.8492054,8.6320566,139.6992239,9.2054883,7.3e-06,g,22.816,22.853,0.05,0.05,24.472,24.472
   632,60351.21734,139.8492054,8.6320566,139.6970959,9.2061844,5.7e-06,r,22.414,22.32,0.043,0.043,24.163,24.163
   632,60356.23982,139.7624114,10.611928,139.2607587,9.3586028,3.09e-05,z,22.276,22.303,0.167,0.167,22.542,22.511
   632,60366.0856,137.8508484,9.4076278,138.4526989,9.6644812,3.53e-05,z,22.248,22.441,0.234,0.233,22.242,22.242
   632,60377.14141,135.9939995,10.2602506,137.6736389,9.9991782,8.7e-06,i,22.612,22.701,0.076,0.076,23.784,23.703
   632,60384.12561,137.578367,10.4153852,137.2810625,10.1951391,9e-06,r,22.692,22.733,0.067,0.067,24.041,24.041
   632,60397.0945,137.6294414,10.4654572,136.8071117,10.5053467,2.82e-05,i,22.715,22.781,0.18,0.18,22.89,22.887
   632,60397.11835,137.6294414,10.4654572,136.8065221,10.5058448,2.86e-05,z,22.447,22.321,0.21,0.209,22.697,22.694
   632,60399.0693,137.5007909,9.6835542,136.7666383,10.5451375,2.45e-05,r,22.901,22.642,0.138,0.138,23.341,23.327
   632,60399.09351,137.5007909,9.6835542,136.7661228,10.5456264,1.57e-05,i,22.846,22.781,0.124,0.124,23.356,23.343
   632,60404.02967,136.6652419,10.7150041,136.703629,10.635411,1.48e-05,r,23.031,22.856,0.093,0.093,23.834,23.834
   632,60407.01166,137.9003026,10.4601787,136.6928919,10.6825895,1.01e-05,r,23.012,22.954,0.078,0.078,24.083,24.064
   632,60407.03549,137.9003026,10.4601787,136.6928541,10.6829441,1.08e-05,i,22.884,22.873,0.094,0.094,23.755,23.735
   632,60419.97412,138.2254847,11.0456903,136.8872669,10.8206369,4.34e-05,i,22.218,22.964,0.272,0.272,22.592,22.563
   632,60426.97045,137.6919103,9.2401203,137.1521501,10.84754,2.4e-05,r,23.096,23.018,0.136,0.136,23.638,23.552
   632,60426.98127,137.6919103,9.2401203,137.1526965,10.8474947,2.59e-05,i,22.967,22.818,0.158,0.158,23.348,23.263
   632,60432.96527,138.1759203,10.3996733,137.4653145,10.8432948,1.47e-05,r,23.093,23.366,0.108,0.108,23.861,23.858
   632,60432.97609,138.1759203,10.3996733,137.4659096,10.8432426,1.12e-05,i,23.105,23.082,0.104,0.104,23.8,23.797
   632,60435.95804,136.7133685,10.5177289,137.6504775,10.8316439,1.94e-05,r,23.373,23.434,0.137,0.137,23.608,23.6
   39265,60370.38399,192.6418095,-32.5378881,193.6750982,-32.7017699,2.8e-06,i,18.027,18.016,0.004,0.004,23.121,23.116

.. note::
   This test run is using pre-made ephemeris generasted by OIF already stored in the demo directory of the github Sorcha repository. 
